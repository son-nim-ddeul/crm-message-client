"use client";
import NewTitle from "@/app/components/new-title";
import Stepper from "@/app/components/stepper";
import "../../design/loading.css";
import { useEffect, useRef, useState } from "react";
import { useRouter } from "next/navigation";
import { useMessageStore } from "@/app/store/message-store";
import { useResponseStore, FinalReportResponse } from "@/app/store/response-store";

const API_URL = "http://ddeul-server.heyhey.cloud";

interface SSEMessage {
  event_status?: string;
  user_id?: string;
  session_id?: string;
  branch?: string | null;
  author?: string | null;
  timestamp?: number;
  is_final_response?: boolean;
  content?: {
    role?: string;
    parts?: Array<{
      text?: string;
      [key: string]: unknown;
    }>;
  };
  final_report_response?: FinalReportResponse;
}

export default function LoadingPage() {
  const description = `AI 에이전트가 고객 데이터를 분석하여 \n 최적의 CRM 마케팅 메시지를 작성하고 있습니다.`;

  const router = useRouter();
  const { persona, purpose, tone, kpi, date, additionalRequests } = useMessageStore();
  const { setMessageResponse } = useResponseStore();
  const hasRequested = useRef(false);
  const [messageList, setMessageList] = useState<string[]>([]);

  const postMessage = async () => {
    const config: Record<string, string | null> = {
      persona_id: persona?.persona_id || null,
      message_purpose: purpose ? `${purpose.name}${purpose.description}` : null,
      brand_tone: tone?.name || null,
      key_marketing_achievements: kpi?.acronym || null,
      message_sending_datetime: date ? new Date(date).toISOString() : null,
      additional_request: additionalRequests || null
    };

    // null 값 제거
    Object.keys(config).forEach((key) => {
      if (config[key] === null || config[key] === "") {
        delete config[key];
      }
    });

    const requestBody = {
      user_id: "test_user",
      config: config
    };

    console.log("[SSE] 요청 시작:", `${API_URL}/messages/run_sse`);
    console.log("[SSE] 요청 데이터:", requestBody);

    try {
      const response = await fetch(`${API_URL}/messages/run_sse`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Accept: "text/event-stream"
        },
        body: JSON.stringify(requestBody)
      });

      console.log("[SSE] 응답 상태:", response.status);

      if (!response.ok) {
        throw new Error(`API Error: ${response.status}`);
      }

      if (!response.body) {
        throw new Error("Response body is null");
      }

      const reader = response.body.getReader();
      const decoder = new TextDecoder();
      let buffer = "";

      while (true) {
        const { done, value } = await reader.read();

        if (done) {
          console.log("[SSE] 스트림 완료");
          // 남은 버퍼 처리
          if (buffer.trim()) {
            processChunk(buffer);
          }
          break;
        }

        const chunk = decoder.decode(value, { stream: true });
        console.log("[SSE] 청크 수신:", chunk.substring(0, 100));
        buffer += chunk;

        // JSON 객체 단위로 파싱 시도
        // { 로 시작해서 } 로 끝나는 완전한 JSON 찾기
        let startIdx = 0;
        while (startIdx < buffer.length) {
          const jsonStart = buffer.indexOf("{", startIdx);
          if (jsonStart === -1) break;

          // 중괄호 매칭으로 완전한 JSON 찾기
          let depth = 0;
          let jsonEnd = -1;
          for (let i = jsonStart; i < buffer.length; i++) {
            if (buffer[i] === "{") depth++;
            else if (buffer[i] === "}") {
              depth--;
              if (depth === 0) {
                jsonEnd = i;
                break;
              }
            }
          }

          if (jsonEnd === -1) {
            // 완전한 JSON이 아직 안 왔음 - 버퍼에 보관
            buffer = buffer.substring(jsonStart);
            break;
          }

          // 완전한 JSON 추출
          const jsonStr = buffer.substring(jsonStart, jsonEnd + 1);
          processChunk(jsonStr);

          startIdx = jsonEnd + 1;
          if (startIdx >= buffer.length) {
            buffer = "";
          }
        }

        // 처리된 부분 제거
        if (startIdx > 0 && startIdx < buffer.length) {
          buffer = buffer.substring(startIdx);
        }
      }

      reader.releaseLock();
    } catch (error) {
      console.error("API Error:", error);
      setMessageList((prev) => [...prev, `[Error] ${error instanceof Error ? error.message : "Unknown error"}`]);
    }
  };

  const processChunk = (jsonStr: string) => {
    try {
      const data: SSEMessage = JSON.parse(jsonStr);
      console.log("========== SSE 메시지 수신 ==========");
      console.log("event_status:", data.event_status);
      console.log("author:", data.author);
      console.log("branch:", data.branch);
      console.log("content:", data.content);
      console.log("======================================");

      // content가 있는 경우
      if (data.content?.parts?.[0]?.text) {
        const textContent = data.content.parts[0].text;
        console.log("📝 텍스트:", textContent);
        setMessageList((prev) => [...prev, `[${data.author}] ${textContent}`]);
      } else if (data.event_status) {
        // 이벤트 상태
        console.log("📡 이벤트:", data.event_status);
        setMessageList((prev) => [...prev, `[${data.author || "system"}] ${data.event_status} - ${data.branch || ""}`]);
      }

      if (data.event_status === "complete" && data.final_report_response) {
        console.log("🎉 완료! final_report_response:", data.final_report_response);
        setMessageResponse(data.final_report_response);
        // 결과 페이지로 이동
        router.push("/new/result");
      }
    } catch (e) {
      console.error("[SSE] JSON 파싱 실패:", jsonStr.substring(0, 50), e);
    }
  };

  useEffect(() => {
    if (hasRequested.current) {
      return;
    }

    hasRequested.current = true;

    postMessage();
  }, []);

  return (
    <div className="flex min-h-screen flex-col">
      <Stepper currentStep={5} />
      <div className="flex flex-col items-center justify-center flex-1">
        <div className="relative">
          <div className="spinner" />
        </div>

        <NewTitle title="메시지 생성 및 성과 예측 중..." description={description} />
      </div>
      {messageList.length > 0 && (
        <div className="w-full max-w-4xl mx-auto px-6 py-4 mt-8">
          <div className="bg-white rounded-lg border border-gray-200 p-4 max-h-96 overflow-y-auto">
            <h3 className="text-lg font-bold text-gray-900 mb-4">진행 상황</h3>
            <div className="space-y-2">
              {messageList.map((message, index) => (
                <div
                  key={index}
                  className="text-sm text-gray-700 bg-gray-50 p-3 rounded border border-gray-200 font-mono whitespace-pre-wrap wrap-break-word"
                >
                  {message}
                </div>
              ))}
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

// const result = {
//   event_status: "complete",
//   user_id: "test_user",
//   session_id: "2051cc5e-c437-4632-8674-c764c176f285",
//   branch: null,
//   author: null,
//   timestamp: 1767753142.688922,
//   is_final_response: null,
//   ui_status: null,
//   content: null,
//   error: null,
//   final_report_response: {
//     playful_entertainer: {
//       title: "요즘 릴스 피드 점령한 대세템! 💖",
//       content:
//         "지민님, 숏폼보다가 심쿵했죠? 요즘 다들 '이거'로 갈아타고 피드 인증 난리! ✨ 성분 걱정? 놉! 화해 켜볼 필요 없이 이미 착한 성분+크루얼티프리 인증 완료! 미니멀 루틴의 끝판왕, 게다가 올영 세일 때 겟하면 완전 혜자! 놓치면 후회할 걸? #레티놀추천 #인생템각",
//       estimation:
//         "## 마케팅 메시지 성과 추정 분석 보고서\n\n### 1. 예상 성과 요약\n\n본 마케팅 메시지 '요즘 릴스 피드 점령한 대세템! 💖'는 'FOMO(Fear Of Missing Out)'와 트렌드를 적극 활용하여 타겟 고객의 즉각적인 반응을 유도하는 데 초점을 맞추고 있습니다. 숏폼 콘텐츠 시청자 및 올리브영 세일에 민감한 소비자를 대상으로 하여, 초기 클릭률(CTR) 및 참여율(Engagement Rate) 측면에서 긍정적인 성과를 기대할 수 있습니다. 특히, 제품의 성분적 안정성과 가성비를 강조하며 구매 장벽을 낮추려는 전략은 최종 전환율에 기여할 것으로 예상됩니다.\n\n### 2. 핵심 성과 지표 (KPI) 예상\n\n현재 구체적인 성과 추정 데이터가 제공되지 않아 정량적인 예측은 어렵습니다. 하지만 메시지의 특성을 고려했을 때, 다음 KPI에서 잠재적인 강점을 보일 것으로 예상됩니다.\n\n*   **클릭률 (CTR):** '릴스 피드 점령', '대세템', '놓치면 후회할 걸?'과 같은 호기심 유발 문구와 트렌디한 어조는 높은 CTR을 달성할 잠재력이 있습니다.\n*   **참여율 (Engagement Rate):** 친근한 이모지 사용과 '피드 인증 난리', '#인생템각' 등의 해시태그는 사용자들의 좋아요, 댓글, 공유, 저장 등 적극적인 참여를 유도할 것으로 보입니다.\n*   **전환율 (Conversion Rate):** '착한 성분+크루얼티프리', '올영 세일 때 겟하면 완전 혜자'와 같은 명확한 가치 제안은 제품 탐색 및 구매 전환으로 이어질 가능성이 높습니다. 그러나 '이거'와 같이 제품명이 명시되지 않은 점은 전환 과정에서 추가적인 탐색 단계를 필요하게 하여 일부 이탈을 발생시킬 수도 있습니다.\n*   **브랜드 인지도 (Brand Awareness):** 숏폼 트렌드와 연계된 키워드 사용은 브랜드 및 제품의 인지도 확산에 기여할 것입니다.\n\n### 3. 예측 근거 및 통계적 통찰 (데이터 부재 시 일반론)\n\n*   **FOMO 마케팅 효과:** '다들 갈아타고 피드 인증 난리'와 같은 문구는 다수의 소비자가 이미 해당 제품을 사용하고 있다는 인상을 주어, 타겟 고객이 뒤처지지 않기 위해 제품을 구매하고 싶게 만드는 심리적 압박감을 유발합니다. 이는 특히 젊은 세대에게 효과적인 전략으로, 과거 유사 캠페인에서 높은 참여율을 보인 바 있습니다.\n*   **페인 포인트 직접 언급:** '성분 걱정? 놉! 화해 켜볼 필요 없이'와 같이 소비자의 일반적인 고민을 직접적으로 해소해주는 메시지는 신뢰도를 높이고 구매 결정을 가속화합니다. 이는 정보 탐색 시간을 단축시켜 이탈률을 낮추는 데 기여할 수 있습니다.\n*   **구체적인 구매 유도:** '올영 세일' 언급은 실제 구매 행동으로 이어지는 명확한 동기를 제공합니다. 이는 단기적인 판매 증진에 효과적인 전술로, 시즌성 캠페인에서 높은 전환율을 보이는 경향이 있습니다.\n\n### 4. 신뢰 수준\n\n현재 구체적인 데이터가 없는 상태에서의 예측이므로, 본 추정은 메시지 콘텐츠 분석에 기반한 **'중간' 수준의 신뢰도**를 가집니다. 실제 캠페인 집행 후 실측 데이터를 기반으로 한 지속적인 모니터링 및 A/B 테스트를 통해 정확도를 높여나가야 합니다.",
//       conclusion:
//         "## 마케팅 메시지 종합 분석 및 실행 전략 보고서\n\n### 1. 메시지 및 성과 추정 종합 분석\n\n본 마케팅 메시지 '요즘 릴스 피드 점령한 대세템! 💖'는 타겟 고객의 행동 패턴과 심리를 효과적으로 파고드는 강점을 지니고 있습니다. 특히, 숏폼 콘텐츠 이용자에게 익숙한 '릴스 피드', '대세템' 등의 키워드를 활용하여 초기 주목도를 극대화하려는 전략이 돋보입니다. '지민님'과 같은 개인화된 호칭, '심쿵', '혜자' 등 친근하고 유행에 민감한 언어 사용은 타겟 고객과의 심리적 거리를 좁히는 데 기여할 것입니다.\n\n메시지 톤은 FOMO와 트렌디함을 강조하여 높은 클릭률(CTR)과 참여율(Engagement Rate)을 유도할 것으로 예상됩니다. 또한, '성분 걱정? 놉!', '화해 켜볼 필요 없이'와 같이 소비자의 주요 페인 포인트를 직접 언급하며 제품의 핵심 가치(안전한 성분)를 빠르게 전달하는 점은 전환율 증진에 긍정적인 영향을 미칠 것으로 분석됩니다. '올영 세일' 언급은 구매 행동을 유도하는 강력한 동기가 됩니다.\n\n다만, 구체적인 제품명이 명시되지 않은 '이거'라는 표현은 호기심을 유발할 수 있으나, 동시에 소비자가 제품을 직접 찾아야 하는 추가적인 단계를 발생시켜 일부 이탈을 야기할 가능성도 존재합니다. 현재 구체적인 성과 추정 데이터가 부재하여 정량적인 목표 설정 및 세부 분석에는 한계가 있으나, 메시지 자체의 구성은 잠재적으로 높은 성과를 기대하게 합니다.\n\n### 2. 전략적 정렬 및 평가\n\n*   **콘텐츠-성과 목표 정렬:** 메시지는 숏폼 콘텐츠를 즐기는 젊은 층을 대상으로 인지도 확산과 즉각적인 구매 유도를 목표로 하며, 이는 메시지 내 트렌드 키워드, FOMO 자극, 올영 세일 언급 등을 통해 잘 정렬되어 있습니다.\n*   **타겟 고객 일치도:** '지민님', '숏폼보다가 심쿵했죠?' 등의 표현은 숏폼 콘텐츠 소비가 활발한 20대 타겟 고객에게 매우 적합하며 높은 공감대를 형성할 것입니다.\n*   **핵심 가치 전달:** '착한 성분+크루얼티프리'라는 핵심 가치를 소비자의 고민(성분 걱정, 화해 앱)과 연계하여 효과적으로 전달하고 있습니다.\n\n### 3. 액션 가능한 권고 사항\n\n1.  **제품명 명확화 전략 수립:** '이거'라는 표현으로 호기심을 유발한 후, 랜딩 페이지나 후속 메시지에서는 반드시 제품명을 명확히 제시하여 구매 전환 과정에서의 이탈을 최소화해야 합니다.\n2.  **비주얼 콘텐츠 강화:** '릴스 피드 점령'이라는 문구에 걸맞게 실제 릴스 형식의 짧고 임팩트 있는 영상 콘텐츠를 메시지와 함께 활용하여 시너지 효과를 창출해야 합니다.\n3.  **해시태그 활용 증대:** '#레티놀추천', '#인생템각' 외에 추가적인 브랜드 또는 제품 고유의 해시태그를 개발하여 사용자 참여를 유도하고, UGC(User Generated Content) 확산을 장려해야 합니다.\n4.  **A/B 테스트 실시:** 메시지 제목('요즘 릴스 피드 점령한 대세템! 💖' vs. 다른 버전), 이모지 사용, 특정 문구(예: '지민님' vs. 다른 개인화 요소) 등에 대한 A/B 테스트를 통해 최적의 성과를 내는 조합을 찾아야 합니다.\n5.  **올리브영 협업 및 프로모션 연계:** '올영 세일' 시기에 맞춰 올리브영과의 협업 프로모션을 적극적으로 진행하여 메시지의 효과를 극대화해야 합니다.\n\n### 4. 핵심 강점 및 개선 영역\n\n*   **강점:** 강력한 FOMO 자극, 타겟 고객 친화적인 언어 및 톤, 주요 페인 포인트 해소, 명확한 구매 유도(올영 세일).\n*   **개선 영역:** 제품명 비명시로 인한 잠재적 전환 저해 요소, 개인화 수준을 높이기 위한 추가적인 데이터 활용 (예: 고객의 실제 관심사 반영).\n\n### 5. 실행 및 모니터링을 위한 전략적 지침\n\n캠페인 실행 후에는 예상 성과 지표(CTR, 참여율, 전환율)를 면밀히 모니터링해야 합니다. 특히, 메시지 클릭 후 랜딩 페이지에서의 행동(제품 페이지 조회수, 장바구니 추가율 등)을 추적하여 '이거'라는 표현이 실제로 전환에 어떤 영향을 미치는지 분석하는 것이 중요합니다. 초기 데이터 분석을 통해 메시지 내용, 랜딩 페이지 경험, 프로모션 방식 등을 유연하게 조정하며 캠페인의 효율성을 지속적으로 최적화해야 합니다."
//     },
//     empathetic_supporter: {
//       title: "수많은 제품 고민, 지민님만 그런 거 아니에요",
//       content:
//         "지민님, 수많은 제품 속에서 어떤 게 좋을지, 광고와 실제 효과는 다를까 늘 고민 많으셨죠? 복잡한 성분표 보며 피부 트러블 원인 찾다 지친 마음, 저희가 누구보다 잘 이해해요. 더 이상 혼자 헤매지 마세요! 저희는 지민님 곁에서 투명한 성분 공개와 검증된 고기능 제품으로 함께 피부 고민을 해결해드릴 파트너가 되어드릴게요. 소용량으로 부담 없이, 안심하고 시작해보세요. 이제는 현명하게 선택할 수 있을 거예요!",
//       estimation:
//         "# 마케팅 메시지 성과 예측 분석 보고서\n\n## 1. 개요\n\n본 보고서는 '수많은 제품 고민, 지민님만 그런 거 아니에요' 메시지의 예상 성과를 분석하고 주요 지표에 대한 예측치를 제공합니다. 메시지의 공감 형성 및 문제 해결 제안 전략이 고객 반응에 미칠 영향을 중심으로 평가했습니다.\n\n## 2. 주요 성과 지표 (KPI) 예측 및 근거\n\n### 2.1. 오픈율 (Open Rate, OR)\n*   **예측치:** 28%\n*   **신뢰도:** 높음\n*   **근거:** 메시지 제목이 '지민님'이라는 직접적인 개인화와 '수많은 제품 고민, 지민님만 그런 거 아니에요'라는 고객의 보편적인 고충을 명확히 언급하여, 수신자의 즉각적인 공감과 관심 유도에 매우 효과적일 것으로 판단됩니다.\n\n### 2.2. 클릭률 (Click-Through Rate, CTR)\n*   **예측치:** 8%\n*   **신뢰도:** 중상\n*   **근거:** 메시지 본문에서 고객의 피부 고민을 깊이 이해하고 있음을 보여주며, '투명한 성분 공개와 검증된 고기능 제품'이라는 해결책과 함께 '소용량으로 부담 없이' 시작할 수 있다는 구체적이고 매력적인 제안이 클릭을 유도할 것입니다. '파산선고 (파산선고는 잘못된 번역인 것 같음 - 아마 '혼자 헤매지 마세요!'를 파트너가 되어드릴게요'로 해석한 듯)'라는 표현은 오타로 추정되나, 메시지 흐름상 고객의 문제 해결 의지를 높여 클릭에 긍정적 영향을 미칠 것입니다.\n\n### 2.3. 체험 상품 전환율 (Conversion Rate for Trial Product)\n*   **예측치:** 3.5%\n*   **신뢰도:** 중\n*   **근거:** '소용량으로 부담 없이, 안심하고 시작해보세요'라는 제안은 신규 고객의 구매 장벽을 효과적으로 낮춰 전환율에 긍정적인 영향을 줄 것으로 예상됩니다. 다만, 최종 전환은 웹사이트의 사용자 경험, 제품 상세 페이지의 정보 명확성, 그리고 후속 가격 정책에 따라 변동될 수 있습니다.\n\n### 2.4. 고객 정서 점수 (Customer Sentiment Score)\n*   **예측치:** 8.5/10 (매우 긍정적)\n*   **신뢰도:** 높음\n*   **근거:** 메시지가 고객의 어려움에 깊이 공감하고, 따뜻한 지지와 함께 해결책을 제시하는 '공감적 지지' 톤을 유지하고 있습니다. 이는 고객에게 긍정적이고 신뢰감을 주는 정서를 유발할 것입니다.\n\n### 2.5. 참여도 점수 (Engagement Score)\n*   **예측치:** 7.8/10 (높음)\n*   **신뢰도:** 높음\n*   **근거:** 고객 중심적인 접근, 개인화된 소통, 그리고 명확한 가치 제안이 메시지 전반에 걸쳐 높은 참여를 유도할 것입니다. 특히 '함께 해결해드릴 파트너가 되어드릴게요'라는 문구는 장기적인 관계 구축에 기여할 수 있습니다.\n\n## 3. 통계적 분석 및 통찰\n\n개인화된 접근과 공감대 형성은 초기 메시지 유효성(오픈율, 클릭률)에 매우 긍정적인 영향을 미칠 것으로 분석됩니다. 특히, '소용량으로 부담 없이'는 전환율 상승에 중요한 기여를 할 것으로 보입니다. 다만, 실제 제품 경험과 후속 상호작용이 장기적인 고객 유지에 더욱 중요합니다. 메시지의 '투명한 성분 공개'와 '검증된 고기능 제품'이라는 핵심 가치 제안이 랜딩 페이지 및 제품 상세 페이지에서 일관되고 신뢰성 있게 전달되어야 예측된 성과를 달성할 수 있습니다.\n\n## 4. 잠재적 리스크 요인\n\n메시지에서 약속한 '투명한 성분 공개'와 '검증된 고기능 제품'이 웹사이트나 제품 페이지에서 명확하고 신뢰성 있게 전달되지 않을 경우, 전환율 저해 및 고객 신뢰도 하락으로 이어질 수 있습니다.",
//       conclusion:
//         "# 마케팅 캠페인 종합 결론 및 실행 전략\n\n## 1. 개요\n\n제안된 마케팅 메시지는 고객의 깊은 공감을 이끌어내고 실질적인 해결책을 제시함으로써 높은 참여와 긍정적인 전환을 유도할 잠재력을 가지고 있습니다. 본 보고서는 메시지 내용과 예상 성과 분석을 종합하여 전략적 시사점과 구체적인 실행 방안을 제시합니다.\n\n## 2. 전략적 정합성 평가\n\n*   **콘텐츠-성과 정합성:** 메시지의 핵심인 '공감'과 '문제 해결 파트너십'은 높은 오픈율과 클릭률, 그리고 긍정적인 고객 정서를 유도할 것으로 예상됩니다. '소용량 체험' 제안은 구매 장벽을 낮춰 전환율에도 긍정적인 영향을 미칠 것입니다. 전반적으로 콘텐츠 전략과 기대 성과 간의 정합성이 매우 높습니다.\n*   **타겟 고객 적합성:** 제품 선택의 어려움과 성분 분석의 피로도를 느끼는 고객(지민님으로 대표되는)의 니즈를 정확히 반영하여 메시지의 관련성을 극대화했습니다.\n\n## 3. 핵심 강점\n\n*   **높은 공감대 형성:** '지민님만 그런 거 아니에요', '혼자 헤매지 마세요'와 같은 표현으로 고객의 고충에 깊이 공감하며 정서적 유대감을 형성합니다.\n*   **명확한 가치 제안:** '투명한 성분 공개'와 '검증된 고기능 제품'을 통해 신뢰할 수 있는 해결책을 제시하며, '소용량 체험'으로 부담 없는 시작을 제안합니다.\n*   **파트너십 강조:** '저희가 파트너가 되어드릴게요'라는 문구를 통해 고객과의 장기적인 관계 구축 의지를 드러냅니다.\n\n## 4. 개선 및 최적화 영역\n\n*   **시각적 요소 강화:** 메시지의 진정성이 웹사이트 랜딩 페이지 및 제품 상세 페이지의 시각적 요소(제품 이미지, 성분 정보 그래픽, 사용자 후기 등)를 통해 더욱 강력하게 전달될 필요가 있습니다.\n*   **후속 커뮤니케이션 전략:** 체험 상품 구매 고객을 위한 맞춤형 온보딩 및 교육 콘텐츠, 그리고 비구매 고객을 위한 리마인드 메시지 등 체계적인 후속 커뮤니케이션 전략을 수립하여 장기적인 고객 관계를 구축해야 합니다.\n*   **A/B 테스트:** 다양한 제목(예: '지민님의 피부 고민, 저희가 함께 해결해 드릴게요')과 CTA(Call to Action) 문구를 A/B 테스트하여 오픈율 및 클릭률을 최적화할 수 있습니다.\n\n## 5. 실행 및 모니터링을 위한 전략적 지침\n\n*   **개인화의 확장:** '지민님'으로 시작하는 개인화는 긍정적이나, 고객의 과거 구매 이력이나 관심사를 기반으로 한 보다 심층적인 개인화 전략을 개발하여 메시지의 관련성을 더욱 높일 수 있습니다.\n*   **투명성 강조:** 메시지에서 약속한 '투명한 성분 공개'는 웹사이트 내 별도 섹션 또는 인터랙티브한 요소로 구현하여 고객이 쉽게 접근하고 이해할 수 있도록 해야 합니다.\n*   **고객 후기 활용:** '검증된 고기능 제품'이라는 주장을 뒷받침할 수 있는 실제 고객들의 사용 후기나 전문가 리뷰를 적극적으로 활용하여 신뢰도를 높여야 합니다.\n*   **성과 지표 지속적 모니터링:** 오픈율, 클릭률, 전환율뿐만 아니라 메시지 발송 후 웹사이트 체류 시간, 이탈률, 검색어 유입 등 다양한 지표를 지속적으로 모니터링하여 캠페인 효과를 정량적으로 분석하고 피드백 루프를 구축해야 합니다.\n*   **장기적 관계 구축:** 일회성 판매보다는 고객의 피부 고민을 지속적으로 케어하는 '파트너'로서의 역할을 강조하는 후속 메시지와 서비스를 통해 고객 생애 가치(LTV)를 극대화해야 합니다."
//     },
//     aspirational_dreamer: {
//       title: "복잡함 없이 빛나는 피부, 당신의 루틴",
//       content:
//         "아침 거울 속, 투명하게 빛나는 당신의 피부를 상상해 보세요. 화해 유저도 만족할 투명한 전 성분 공개, 레티놀·펩타이드 등 핵심 고기능 성분으로 완성된 솔루션이 당신이 꿈꾸던 자신감을 선물합니다. 숏폼으로 얻은 정보, 수많은 찐 리뷰가 증명하는 확실한 효과로 복잡한 루틴 없이 스마트한 선택을! 당신의 뷰티 고민, 이제 끝내세요.",
//       estimation:
//         "# 성과 추정 분석 보고서\n\n본 보고서는 제공된 마케팅 메시지에 대한 성과 추정 분석을 담고 있습니다. 다만, **메시지 성과 추정 데이터([generated_message_estimation_key])가 명확히 제공되지 않아, 구체적인 예측 지표 및 수치적 분석은 어렵습니다.** 따라서, 메시지의 내용과 기획 의도를 바탕으로 잠재적인 성과 가능성을 추론하고, 향후 데이터 확보 시 분석 방향성을 제시하는 방식으로 보고서를 구성합니다.\n\n## 주요 성과 지표 (KPIs) 분석 및 예상 근거 (메시지 기반 추론)\n\n구체적인 수치 예측은 불가하나, 메시지의 특징을 기반으로 다음 KPI에 대한 잠재적 영향을 추론할 수 있습니다.\n\n*   **클릭률 (CTR) 잠재력:**\n    *   **예상:** 잠재적으로 높은 CTR을 기대할 수 있습니다.\n    *   **근거:** 메시지 제목인 '복잡함 없이 빛나는 피부, 당신의 루틴'은 즉각적인 문제 해결과 이상적인 결과에 대한 호기심을 자극합니다. 본문에서는 '투명하게 빛나는 당신의 피부를 상상해 보세요'와 같이 감성적인 접근과 함께 '화해 유저 만족', '레티놀·펩타이드 등 핵심 고기능 성분'과 같은 구체적인 가치 제안을 통해 타겟 페르소나의 관심을 효과적으로 유도할 것입니다. '스마트한 선택'이라는 표현은 바쁜 현대인의 니즈를 공략하여 클릭을 유도할 가능성이 높습니다.\n*   **전환율 (Conversion Rate) 잠재력:**\n    *   **예상:** 잠재적으로 긍정적인 전환율을 기대할 수 있습니다.\n    *   **근거:** 메시지는 제품의 핵심 강점(투명한 성분, 고기능 성분)과 고객이 얻을 수 있는 이점(자신감, 복잡하지 않은 루틴)을 명확히 연결합니다. 특히 '수많은 찐 리뷰가 증명하는 확실한 효과'는 잠재 고객의 불신을 해소하고 구매 결정에 대한 신뢰도를 높여 전환에 긍정적인 영향을 미칠 것으로 예상됩니다.\n*   **참여율 (Engagement Rate) 잠재력:**\n    *   **예상:** 잠재적으로 높은 참여율을 기대할 수 있습니다.\n    *   **근거:** '숏폼으로 얻은 정보' 언급은 타겟 페르소나의 정보 소비 패턴을 반영하여 공감대를 형성하며, '뷰티 고민, 이제 끝내세요'와 같은 직접적인 해결책 제시는 메시지에 대한 몰입과 추가 정보 탐색으로 이어질 수 있습니다. 이는 댓글, 공유 등 참여를 유도하는 요소로 작용할 것입니다.\n*   **브랜드 센티멘트 (Brand Sentiment) 잠재력:**\n    *   **예상:** 매우 긍정적인 센티멘트 형성을 기대할 수 있습니다.\n    *   **근거:** 고객의 이상적인 모습(투명하게 빛나는 피부)을 제시하고, 구체적인 성분과 실제 사용자의 만족감을 강조하여 신뢰를 구축합니다. 또한 '복잡함 없이 스마트한 선택'이라는 키워드는 고객의 라이프스타일을 이해하고 있다는 인상을 주어 브랜드에 대한 호감을 높일 것입니다.\n\n## 통계적 통찰 및 신뢰 수준 (데이터 부재로 인한 제한적 분석)\n\n제공된 성과 추정 데이터가 부재하여, 통계적 통찰이나 특정 수치에 대한 신뢰 수준을 명확히 제시하기 어렵습니다. 현재로서는 메시지의 구성과 타겟 페르소나에 대한 이해도를 바탕으로 '높은 잠재력' 또는 '긍정적 영향'과 같은 질적 평가만 가능합니다.\n\n**권고 사항:** 향후 마케팅 캠페인 실행 시, 명확한 KPI를 설정하고 A/B 테스트를 포함한 다양한 방법론을 통해 메시지의 실제 성과 데이터를 수집 및 분석하여, 보다 정량적이고 신뢰도 높은 추정치를 확보하는 것이 필수적입니다.",
//       conclusion:
//         "# 종합 결론 보고서\n\n본 보고서는 '복잡함 없이 빛나는 피부, 당신의 루틴' 마케팅 메시지와 가상의 성과 추정 분석(데이터 부재로 인한 메시지 기반 추론)을 종합하여 핵심적인 결론과 실행 권고 사항을 제시합니다.\n\n## 메시지 및 성과 추정 분석 종합\n\n**메시지의 강점:**\n생성된 메시지는 페르소나의 핵심 니즈와 열망을 정확히 파악하여 설득력 있게 구성되었습니다. '투명한 성분 공개', '고기능 성분(레티놀·펩타이드)', '화해 유저 만족', '수많은 찐 리뷰' 등의 키워드는 신뢰성과 효과에 대한 잠재 고객의 우려를 효과적으로 해소합니다. 또한 '복잡함 없이 빛나는 피부', '스마트한 선택'은 현대인의 시간 절약과 효율성 추구라는 라이프스타일에 부합하며, 제품을 통한 이상적인 자신감 획득을 강조하여 강력한 감성적 연결고리를 형성합니다. 제목과 본문의 유기적인 연결, 그리고 개인화된 호소력('당신')은 메시지의 몰입도를 높입니다.\n\n**성과 추정 분석의 한계:**\n안타깝게도, 구체적인 성과 추정 데이터가 제공되지 않아 메시지의 잠재력을 정량적으로 평가하고 특정 KPI 달성 여부를 예측하는 데 한계가 있었습니다. 따라서 앞선 '성과 추정 분석 보고서'에서는 메시지 내용에 기반한 잠재적 효과만을 질적으로 추론했습니다. 메시지 자체의 높은 완성도를 고려할 때, 긍정적인 성과를 기대할 수 있는 요소들이 다수 존재합니다.\n\n## 전략적 정합성 평가\n\n메시지는 페르소나의 뷰티 고민(성분 불신, 복잡한 루틴, 과대 광고 피로도)을 해결하고 '빛나는 피부를 통한 자신감'이라는 궁극적인 열망을 충족시키려는 마케팅 목표와 매우 높은 정합성을 보입니다. 제품의 USP(고기능성, 투명한 성분)를 명확히 전달하면서도 감성적인 소구를 잊지 않아, 단순히 제품을 파는 것을 넘어 고객에게 가치와 라이프스타일을 제안하는 전략적 방향과 일치합니다.\n\n## 주요 강점 및 개선 영역\n\n*   **강점:**\n    *   **강력한 페르소나 공략:** '화해 유저', '숏폼 정보' 등 타겟의 특성을 반영하여 높은 공감대 형성.\n    *   **신뢰도 높은 소구:** '투명한 전 성분 공개', '찐 리뷰'를 통해 제품에 대한 신뢰를 구축.\n    *   **이상적인 라이프스타일 제시:** '복잡함 없이 빛나는 피부', '스마트한 선택'으로 고객의 꿈을 자극.\n    *   **명확한 가치 제안:** 핵심 성분 명시로 제품의 효능을 직관적으로 전달.\n*   **개선 영역:**\n    *   **성과 데이터 부재:** 현재로서는 메시지의 실제 시장 반응을 예측할 수 있는 정량적 데이터가 부족하여 전략 수정 및 최적화에 어려움이 예상됩니다.\n    *   **경쟁사와의 차별점 심화:** '고기능 성분'은 보편적인 소구일 수 있으므로, 해당 제품만의 독점적인 제형, 기술, 혹은 사용자 경험에 대한 추가적인 강조를 통해 경쟁 우위를 더욱 확고히 할 필요가 있습니다.\n\n## 실행 및 모니터링을 위한 전략적 가이드\n\n1.  **성과 지표 (KPIs) 설정 및 추적 시스템 구축:** 캠페인 시작 전, CTR, 전환율, 메시지 공유율, 브랜드 언급량 등 핵심 KPI를 명확히 설정하고, 이를 실시간으로 추적하고 분석할 수 있는 시스템을 반드시 구축해야 합니다.\n2.  **A/B 테스트 및 메시지 최적화:** 동일한 메시지를 다양한 형태로 변형(예: 제목, CTA 문구, 이미지/영상 조합)하여 A/B 테스트를 진행하고, 가장 높은 성과를 보이는 버전을 선별하여 지속적으로 메시지를 최적화해야 합니다.\n3.  **고객 여정별 맞춤형 커뮤니케이션:** 메시지가 타겟 페르소나의 다양한 고객 여정 단계(인지-고려-구매-재구매)에서 어떻게 작용할지 고려하여, 각 단계에 맞는 추가적인 정보나 소구를 제공하는 전략을 수립해야 합니다.\n4.  **피드백 루프 구축:** 소셜 미디어 모니터링, 고객 설문조사 등을 통해 실제 고객 반응과 피드백을 수집하고, 이를 다음 메시지 기획 및 캠페인 전략에 반영하는 순환 구조를 만들어야 합니다.\n5.  **콘텐츠 확장을 통한 메시지 강화:** 숏폼, 블로그, 인플루언서 협업 등 다양한 채널별 콘텐츠 전략을 수립하여 메시지의 신뢰도를 강화하고 확산력을 높여야 합니다. 특히 '찐 리뷰'를 강조한 만큼, 실제 사용자들의 UGC(User-Generated Content)를 적극적으로 활용하는 것이 중요합니다.\n\n## 권고 사항\n\n제시된 메시지는 매우 높은 잠재력을 가지고 있습니다. 이 메시지의 효과를 극대화하기 위해서는, 캠페인 실행 시 반드시 체계적인 성과 측정 및 분석 시스템을 갖추고 지속적인 최적화 노력을 병행해야 합니다. 데이터 기반의 의사결정을 통해 메시지의 가치를 현실적인 성과로 연결시키는 데 집중해야 할 것입니다."
//     },
//     rational_advisor: {
//       title: "결정 피로 끝! 바이탈랩으로 성분 중심 스킨케어",
//       content:
//         "수많은 제품 선택지로 고민이신가요? 레티놀, 펩타이드 등 고기능 성분 제품 선택 시 '투명한 성분 공개'와 '정확한 함량'은 필수죠. 복잡한 과정 없이 오직 효능에 집중한 '바이탈랩 펩타이드 리페어 세럼'은 어떠세요? 불필요한 성분은 배제하고, 지민님의 니즈에 맞춰 펩타이드 핵심 성분을 고효율로 담았어요. 크루얼티프리 철학까지 더한 미니멀 패키징으로 스마트한 루틴을 완성하세요. 지금 바로 올리브영에서 바이탈랩을 검색하고, 당신의 피부를 위한 최적의 선택을 경험해보세요!",
//       estimation:
//         "# 메시지 성능 추정 분석 보고서\n\n제공된 메시지 성능 추정 데이터(`[generated_message_estimation_key]`)가 구체적으로 특정되지 않아, 본 보고서는 일반적으로 마케팅 메시지 성능 추정에 포함될 주요 지표 및 고려사항을 중심으로 작성되었으며, 특정 수치 기반의 분석은 어려운 점을 미리 알려드립니다.\n\n## 1. 핵심 성과 지표 (KPI) 예상 분석 (데이터 부재)\n\n일반적으로 다음과 같은 핵심 성과 지표들을 통해 마케팅 메시지의 성능을 추정합니다. 하지만 현재 데이터 부재로 인해 구체적인 예측 수치는 제공할 수 없습니다.\n\n*   **클릭률 (CTR):** 메시지 제목의 매력도('결정 피로 끝! 바이탈랩으로 성분 중심 스킨케어')와 내용의 흥미 유발 정도, 그리고 명확한 행동 유도(CTA)가 클릭률에 영향을 미칩니다. 현재 메시지는 페르소나의 고민을 명확히 언급하고 해결책을 제시하여 높은 CTR을 기대할 수 있으나, 정량적 예측은 불가합니다.\n*   **전환율 (Conversion Rate):** '바이탈랩 펩타이드 리페어 세럼'에 대한 신뢰성 있는 정보 제공, '크루얼티프리', '미니멀 패키징' 등 추가 가치 어필, 그리고 '올리브영'이라는 친숙한 구매 채널 제시가 전환율에 긍정적인 영향을 줄 수 있습니다.\n*   **참여율 (Engagement Rate):** 메시지 내용이 타겟 페르소나의 니즈에 얼마나 깊이 공감하고 있는지, 그리고 전달 방식이 얼마나 효과적인지가 참여율에 영향을 미칩니다. 성분 중심 스킨케어에 대한 관심이 높은 타겟층에게는 높은 참여율을 기대할 수 있습니다.\n*   **브랜드 인지도 상승 (Brand Lift):** '바이탈랩'이라는 가상 브랜드를 메시지 전반에 걸쳐 노출하고, 그 특징을 명확히 설명함으로써 브랜드 인지도 향상에 기여할 수 있습니다.\n\n## 2. 성능 예측의 근거 및 통계적 통찰 (데이터 부재)\n\n구체적인 추정 데이터가 부재하여, 이러한 지표들에 대한 정량적 분석 및 통계적 통찰은 제공하기 어렵습니다. 일반적으로 성능 예측은 다음을 기반으로 합니다:\n\n*   **과거 캠페인 데이터:** 유사한 타겟, 제품, 채널에서 진행된 과거 캠페인의 성과 데이터를 분석하여 예측합니다.\n*   **A/B 테스트 결과:** 메시지 변형(제목, CTA, 이미지 등)에 따른 반응 차이를 실제 실험을 통해 확인하여 최적의 메시지를 도출합니다.\n*   **시장 벤치마크 및 산업 평균:** 해당 산업 및 채널의 일반적인 성과 지표를 참고하여 현실적인 목표를 설정합니다.\n\n## 3. 신뢰 수준 및 제언 (데이터 부재)\n\n제공된 추정 데이터가 없어 본 메시지 성능 예측에 대한 신뢰 수준을 설정할 수 없습니다. 실제 캠페인 진행 시, 초기 데이터 수집 및 분석을 통해 메시지의 효과를 면밀히 모니터링하고, 필요에 따라 메시지 내용이나 전달 방식을 지속적으로 최적화하는 전략이 필수적입니다.",
//       conclusion:
//         "# 마케팅 메시지 종합 결론 보고서\n\n제공된 마케팅 메시지의 내용(`GENERATED MESSAGE`)과 생성 의도(`tone_rationale`, `revision_notes`)를 바탕으로 전략적 적합성 및 개선 방안을 분석합니다. 다만, 메시지 성능 추정 데이터가 제공되지 않아, 예측 성과에 기반한 심층적인 분석 및 최적화 제안에는 한계가 있음을 알려드립니다.\n\n## 1. 메시지 전략 평가\n\n*   **타겟 페르소나 적합성:**\n    *   메시지는 '결정 피로', '고기능 성분', '크루얼티프리', '미니멀 패키징', '올리브영 구매' 등 페르소나의 핵심 선호도와 고민을 매우 효과적으로 반영하고 있습니다. '수많은 제품 선택지로 고민이신가요?'라는 질문으로 공감을 얻으며 시작하는 점이 강점입니다.\n    *   '바이탈랩 펩타이드 리페어 세럼'이라는 제품을 특정하여 페르소나의 니즈(고기능 성분, 투명한 성분 공개, 정확한 함량)와 연결함으로써 명확한 해결책을 제시합니다.\n*   **홍보 목적 달성도:**\n    *   이전 피드백('홍보 목적 미달성')을 반영하여 가상의 브랜드 '바이탈랩'과 제품을 도입하고, '지금 바로 올리브영에서 바이탈랩을 검색하고, 당신의 피부를 위한 최적의 선택을 경험해보세요!'라는 구체적이고 직접적인 CTA를 제시함으로써 '홍보' 목적을 성공적으로 강화했습니다.\n*   **메시지 톤 앤 매너:**\n    *   차분하고 조언하는 듯한 어조로 시작하여 공감을 얻고, 객관적인 선택 기준을 제시한 후 제품으로 자연스럽게 연결하는 흐름이 설득력 있습니다. '투명한 성분 공개', '정확한 함량'과 같은 키워드는 신뢰감을 구축하는 데 기여합니다.\n*   **가치 제안:**\n    *   '결정 피로 끝!'이라는 명확한 문제 해결과 함께, '고효율 핵심 성분', '크루얼티프리 철학', '미니멀 패키징' 등의 부가적인 가치를 어필하여 제품의 매력을 다각도로 보여줍니다.\n\n## 2. 주요 강점\n\n*   **명확한 페르소나 타겟팅:** 페르소나의 고민과 선호도를 깊이 이해하고 메시지에 효과적으로 녹여냈습니다.\n*   **구체적인 제품 및 구매 채널 제시:** 가상 브랜드와 제품을 활용하여 메시지의 홍보 목적을 명확히 하고, 구매 전환으로 이어질 수 있는 실질적인 정보를 제공합니다.\n*   **논리적이고 설득력 있는 구성:** 공감-문제제기-해결책 제시-가치 어필-행동 유도의 흐름이 자연스럽습니다.\n*   **브랜드 가치 어필:** 크루얼티프리, 미니멀 패키징 등 현대 소비자가 중시하는 가치를 함께 전달하여 브랜드 이미지를 강화합니다.\n\n## 3. 개선 영역 및 권고사항\n\n*   **성과 모니터링 및 최적화:** 메시지 성능 추정 데이터가 부재한 만큼, 실제 캠페인 진행 시 **클릭률(CTR), 전환율(Conversion Rate), 제품 페이지 조회 수** 등 핵심 지표에 대한 면밀한 모니터링이 필수적입니다. 초기 데이터 분석을 통해 메시지의 효과를 검증하고, 예상보다 낮은 성과를 보일 경우 메시지 내용, 타겟팅, 채널 등을 유연하게 조정해야 합니다.\n*   **A/B 테스트 활용:** 메시지의 제목('결정 피로 끝!'), CTA 문구('지금 바로 올리브영에서 바이탈랩을 검색하고') 등 핵심 요소를 다양하게 변형하여 어떤 버전이 페르소나에게 더 효과적으로 소구하는지 A/B 테스트를 진행하는 것을 권장합니다.\n*   **추가적인 개인화:** 메시지 내 '지민님'이라는 표현을 실제 발송 시 타겟 소비자의 이름으로 동적으로 삽입하는 등의 추가적인 개인화 전략을 통해 더욱 강력한 유대감과 참여율을 이끌어낼 수 있습니다.\n\n## 4. 전략적 실행 및 모니터링 지침\n\n메시지 자체는 페르소나의 니즈와 홍보 목적에 매우 잘 부합하게 구성되었습니다. 그러나 실제 마케팅 캠페인의 성공은 메시지 전달 후의 성과 데이터를 기반으로 한 지속적인 분석과 최적화 과정에 달려있습니다.\n\n*   **초기 성과 측정:** 캠페인 시작 후 단기적인 성과(예: 첫 주 클릭률, 웹사이트 유입률)를 면밀히 측정하여 메시지의 초기 반응을 파악합니다.\n*   **데이터 기반 의사결정:** 측정된 데이터를 바탕으로 메시지의 강점과 약점을 파악하고, 필요시 메시지 수정, 타겟 재설정, 채널 변경 등 신속한 의사결정을 내릴 준비를 합니다.\n*   **장기적인 관점:** 단기적인 성과뿐만 아니라, 브랜드 인지도 및 고객 충성도 향상 등 장기적인 관점에서의 영향도 함께 고려하여 캠페인 전략을 지속적으로 발전시켜야 합니다."
//     }
//   }
// };
